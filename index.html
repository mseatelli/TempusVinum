<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempus Vinum - Gestionnaire de Cave</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 16px;
            transition: all 0.3s;
            color: #333;
            font-weight: 500;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #8B0000;
            font-weight: bold;
            color: #8B0000;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .config-section h3 {
            margin-bottom: 15px;
            color: #8B0000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8B0000;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: #8B0000;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover {
            background: #660000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
        }

        .cellar-grid {
            display: grid;
            gap: 10px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 10px;
        }

        .cell {
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            position: relative;
            background: white;
            min-height: 80px;
        }

        .cell:hover {
            border-color: #8B0000;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .cell.filled {
            background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);
            color: white;
            font-weight: bold;
        }

        .cell.special {
            min-height: 120px;
            aspect-ratio: 0.7;
        }

        .cell.red { background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%); color: white; }
        .cell.white { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; }
        .cell.rose { background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%); color: white; }
        .cell.champagne { background: linear-gradient(135deg, #F0E68C 0%, #DAA520 100%); color: #333; }
        .cell.other { background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%); color: white; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .close {
            font-size: 30px;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .close:hover {
            color: #8B0000;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .wine-info {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .wine-info h4 {
            color: #8B0000;
            margin-bottom: 10px;
        }

        .wine-info p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .btn-secondary {
            background: #666;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #ddd;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üç∑ Tempus Vinum</h1>
            <p>G√©rez votre collection de vins avec style</p>
        </header>

        <div class="tabs">
            <button class="tab active" data-tab="config" onclick="switchTab('config')">Configuration</button>
            <button class="tab" data-tab="cellar" onclick="switchTab('cellar')">Ma Cave</button>
            <button class="tab" data-tab="inventory" onclick="switchTab('inventory')">Inventaire</button>
        </div>

        <div id="config" class="tab-content active">
            <div class="config-section">
                <h3>üìê Configuration de la cave principale</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre d'√©tag√®res (rang√©es verticales)</label>
                        <input type="number" id="rows" value="5" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label>Nombre d'emplacements par √©tag√®re (horizontalement)</label>
                        <input type="number" id="cols" value="6" min="1" max="30">
                    </div>
                </div>
                <button onclick="initCellar()">Cr√©er/R√©initialiser la cave</button>
            </div>

            <div class="config-section">
                <h3>üçæ Zone sp√©ciale (grandes bouteilles)</h3>
                <div class="form-group">
                    <label>Nombre d'emplacements pour grandes bouteilles (Champagne, Magnum...)</label>
                    <input type="number" id="specialZone" value="7" min="0" max="20">
                </div>
                <button onclick="updateSpecialZone()">Mettre √† jour la zone sp√©ciale</button>
            </div>

            <div class="config-section">
                <h3>üí° Configuration sugg√©r√©e pour votre cave</h3>
                <p>D'apr√®s votre description :</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>2 clayettes</strong> de 6 bouteilles = 12 bouteilles</li>
                    <li><strong>2 rang√©es au-dessus</strong> (3√ó6) = 18 bouteilles</li>
                    <li><strong>Total zone principale :</strong> 30 bouteilles (5 rang√©es √ó 6 emplacements)</li>
                    <li><strong>Zone sp√©ciale :</strong> 7 grandes bouteilles</li>
                    <li><strong>Capacit√© totale :</strong> 37 emplacements</li>
                </ul>
                <button onclick="applySuggestedConfig()">Appliquer cette configuration</button>
            </div>
        </div>

        <div id="cellar" class="tab-content">
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalBottles">0</h3>
                    <p>Bouteilles</p>
                </div>
                <div class="stat-card">
                    <h3 id="emptySpaces">0</h3>
                    <p>Emplacements vides</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalValue">0‚Ç¨</h3>
                    <p>Valeur totale</p>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);"></div>
                    <span>Rouge</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);"></div>
                    <span>Blanc</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);"></div>
                    <span>Ros√©</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #F0E68C 0%, #DAA520 100%);"></div>
                    <span>Champagne</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);"></div>
                    <span>Autre</span>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #8B0000;">üç∑ Zone principale de la cave</h3>
            <div id="cellarGrid" class="cellar-grid"></div>

            <h3 style="margin: 30px 0 10px 0; color: #8B0000;">üçæ Zone grandes bouteilles (Champagne, Magnum...)</h3>
            <div id="specialZoneGrid" class="cellar-grid" style="grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); max-width: 800px;"></div>
        </div>

        <div id="inventory" class="tab-content">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Rechercher par nom, domaine, appellation, ann√©e..." onkeyup="filterInventory()">
            </div>
            <div id="inventoryList"></div>
        </div>
    </div>

    <div id="wineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ajouter une bouteille</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="wineForm" onsubmit="saveWine(event)">
                <input type="hidden" id="cellPosition">
                
                <h3>Informations g√©n√©rales</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Appellation *</label>
                        <input type="text" id="appellation" required>
                    </div>
                    <div class="form-group">
                        <label>Domaine/Ch√¢teau *</label>
                        <input type="text" id="domaine" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>R√©coltant/Producteur</label>
                        <input type="text" id="recoltant">
                    </div>
                    <div class="form-group">
                        <label>Mill√©sime (ann√©e) *</label>
                        <input type="number" id="annee" min="1900" max="2030" required>
                    </div>
                </div>

                <h3>Caract√©ristiques</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Couleur *</label>
                        <select id="couleur" required>
                            <option value="red">Rouge</option>
                            <option value="white">Blanc</option>
                            <option value="rose">Ros√©</option>
                            <option value="champagne">Champagne/Effervescent</option>
                            <option value="other">Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="type">
                            <option value="vin">Vin tranquille</option>
                            <option value="champagne">Champagne</option>
                            <option value="cremant">Cr√©mant</option>
                            <option value="mousseux">Mousseux</option>
                            <option value="petillant">P√©tillant</option>
                            <option value="liquoreux">Liquoreux</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Pays</label>
                        <input type="text" id="pays" value="France">
                    </div>
                    <div class="form-group">
                        <label>R√©gion</label>
                        <input type="text" id="region">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>C√©page(s)</label>
                        <input type="text" id="cepage" placeholder="Ex: Cabernet Sauvignon, Merlot">
                    </div>
                    <div class="form-group">
                        <label>Degr√© d'alcool (%)</label>
                        <input type="number" id="degre" step="0.1" min="0" max="25">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Contenance (ml)</label>
                        <select id="contenance">
                            <option value="375">375 ml (Demi-bouteille)</option>
                            <option value="750" selected>750 ml (Bouteille standard)</option>
                            <option value="1500">1500 ml (Magnum)</option>
                            <option value="3000">3000 ml (J√©roboam)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bio ?</label>
                        <select id="bio">
                            <option value="non">Non</option>
                            <option value="oui">Oui</option>
                            <option value="biodynamie">Biodynamie</option>
                        </select>
                    </div>
                </div>

                <h3>Conservation et valeur</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Prix d'achat (‚Ç¨)</label>
                        <input type="number" id="prix" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>√Ä boire jusqu'en</label>
                        <input type="number" id="aBoireJusque" min="2024" max="2100">
                    </div>
                </div>

                <div class="form-group">
                    <label>Accords mets/vins</label>
                    <textarea id="accords" placeholder="Les accords seront recherch√©s automatiquement si laiss√© vide"></textarea>
                </div>

                <div class="form-group">
                    <label>Notes personnelles</label>
                    <textarea id="notes" placeholder="Vos commentaires, d√©gustation..."></textarea>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit">Enregistrer</button>
                    <button type="button" class="btn-secondary" onclick="closeModal()">Annuler</button>
                    <button type="button" class="btn-danger" id="deleteBtn" onclick="deleteWine()" style="display:none;">Supprimer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Changer d'onglet
        function switchTab(tabName) {
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet et le contenu s√©lectionn√©s
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            // Rafra√Æchir l'inventaire si on passe sur cet onglet
            if (tabName === 'inventory') {
                renderInventory();
            }
        }

        let cellarData = {
            config: { rows: 5, cols: 6, specialZone: 7 },
            wines: {},
            specialWines: {}
        };

        // Charger les donn√©es depuis le localStorage
        function loadData() {
            const saved = localStorage.getItem('wineCellar');
            if (saved) {
                cellarData = JSON.parse(saved);
                document.getElementById('rows').value = cellarData.config.rows;
                document.getElementById('cols').value = cellarData.config.cols;
                document.getElementById('specialZone').value = cellarData.config.specialZone || 0;
            }
            renderCellar();
            renderSpecialZone();
            updateStats();
        }

        // Sauvegarder les donn√©es dans le localStorage
        function saveData() {
            localStorage.setItem('wineCellar', JSON.stringify(cellarData));
        }

        // Appliquer la configuration sugg√©r√©e
        function applySuggestedConfig() {
            document.getElementById('rows').value = 5;
            document.getElementById('cols').value = 6;
            document.getElementById('specialZone').value = 7;
            
            if (confirm('Appliquer la configuration sugg√©r√©e (5 rang√©es √ó 6 emplacements + 7 grandes bouteilles) ? Cela r√©initialisera votre cave.')) {
                cellarData.config = { rows: 5, cols: 6, specialZone: 7 };
                cellarData.wines = {};
                cellarData.specialWines = {};
                saveData();
                renderCellar();
                renderSpecialZone();
                updateStats();
                switchTab('cellar');
            }
        }

        // Initialiser la cave
        function initCellar() {
            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);
            
            if (confirm('√ätes-vous s√ªr ? Cela r√©initialisera la zone principale de la cave.')) {
                cellarData.config.rows = rows;
                cellarData.config.cols = cols;
                cellarData.wines = {};
                saveData();
                renderCellar();
                updateStats();
                switchTab('cellar');
            }
        }

        // Mettre √† jour la zone sp√©ciale
        function updateSpecialZone() {
            const specialZone = parseInt(document.getElementById('specialZone').value);
            
            if (confirm('√ätes-vous s√ªr ? Cela r√©initialisera la zone des grandes bouteilles.')) {
                cellarData.config.specialZone = specialZone;
                cellarData.specialWines = {};
                saveData();
                renderSpecialZone();
                updateStats();
                switchTab('cellar');
            }
        }

        // Afficher la cave principale
        function renderCellar() {
            const grid = document.getElementById('cellarGrid');
            const { rows, cols } = cellarData.config;
            
            grid.style.gridTemplateColumns = `repeat(${cols}, minmax(80px, 1fr))`;
            grid.innerHTML = '';

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const position = `${r}-${c}`;
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    const wine = cellarData.wines[position];
                    if (wine) {
                        cell.classList.add('filled', wine.couleur);
                        cell.innerHTML = `<div style="text-align: center; padding: 5px;">
                            <div style="font-weight: bold; font-size: 0.9em;">${wine.domaine}</div>
                            <div style="font-size: 0.8em; opacity: 0.9;">${wine.annee}</div>
                        </div>`;
                    } else {
                        cell.innerHTML = `<span style="opacity: 0.3; font-size: 2em;">+</span>`;
                    }
                    
                    cell.onclick = () => openModal(position, false);
                    grid.appendChild(cell);
                }
            }
        }

        // Afficher la zone sp√©ciale
        function renderSpecialZone() {
            const grid = document.getElementById('specialZoneGrid');
            const specialZone = cellarData.config.specialZone || 0;
            
            grid.innerHTML = '';

            for (let i = 0; i < specialZone; i++) {
                const position = `special-${i}`;
                const cell = document.createElement('div');
                cell.className = 'cell special';
                
                const wine = cellarData.specialWines[position];
                if (wine) {
                    cell.classList.add('filled', wine.couleur);
                    cell.innerHTML = `<div style="text-align: center; padding: 5px;">
                        <div style="font-weight: bold; font-size: 0.9em;">${wine.domaine}</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">${wine.annee}</div>
                        <div style="font-size: 0.7em; opacity: 0.8; margin-top: 3px;">${wine.contenance}ml</div>
                    </div>`;
                } else {
                    cell.innerHTML = `<span style="opacity: 0.3; font-size: 2em;">+</span>`;
                }
                
                cell.onclick = () => openModal(position, true);
                grid.appendChild(cell);
            }
        }

        // Ouvrir le modal
        function openModal(position, isSpecial = false) {
            const modal = document.getElementById('wineModal');
            const wine = isSpecial ? cellarData.specialWines[position] : cellarData.wines[position];
            
            document.getElementById('cellPosition').value = position;
            document.getElementById('cellPosition').dataset.isSpecial = isSpecial;
            
            if (wine) {
                const posDisplay = isSpecial ? 
                    `Grande bouteille n¬∞${parseInt(position.split('-')[1]) + 1}` :
                    `√âtag√®re ${parseInt(position.split('-')[0]) + 1}, Emplacement ${parseInt(position.split('-')[1]) + 1}`;
                document.getElementById('modalTitle').textContent = `Modifier - ${posDisplay}`;
                document.getElementById('deleteBtn').style.display = 'inline-block';
                
                // Remplir le formulaire
                Object.keys(wine).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) input.value = wine[key] || '';
                });
            } else {
                const posDisplay = isSpecial ? 
                    `Grande bouteille n¬∞${parseInt(position.split('-')[1]) + 1}` :
                    `√âtag√®re ${parseInt(position.split('-')[0]) + 1}, Emplacement ${parseInt(position.split('-')[1]) + 1}`;
                document.getElementById('modalTitle').textContent = `Ajouter - ${posDisplay}`;
                document.getElementById('deleteBtn').style.display = 'none';
                document.getElementById('wineForm').reset();
            }
            
            modal.classList.add('active');
        }

        // Fermer le modal
        function closeModal() {
            document.getElementById('wineModal').classList.remove('active');
        }

        // Rechercher des accords mets/vins
        async function searchFoodPairings(wine) {
            try {
                const query = `${wine.appellation} ${wine.annee} accords mets vins`;
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `Sugg√®re 3-5 accords mets/vins pour un ${wine.couleur === 'red' ? 'vin rouge' : wine.couleur === 'white' ? 'vin blanc' : wine.couleur === 'rose' ? 'vin ros√©' : 'vin'} ${wine.appellation} de ${wine.annee}. R√©ponds uniquement avec une liste courte et concise, sans introduction.`
                        }]
                    })
                });

                const data = await response.json();
                if (data.content && data.content[0] && data.content[0].text) {
                    return data.content[0].text.trim();
                }
            } catch (error) {
                console.log('Recherche d\'accords non disponible');
            }
            return '';
        }

        // Sauvegarder le vin
        async function saveWine(event) {
            event.preventDefault();
            
            const position = document.getElementById('cellPosition').value;
            const isSpecial = document.getElementById('cellPosition').dataset.isSpecial === 'true';
            const accordsInput = document.getElementById('accords').value;
            
            const wine = {
                appellation: document.getElementById('appellation').value,
                domaine: document.getElementById('domaine').value,
                recoltant: document.getElementById('recoltant').value,
                annee: document.getElementById('annee').value,
                prix: parseFloat(document.getElementById('prix').value) || 0,
                pays: document.getElementById('pays').value,
                region: document.getElementById('region').value,
                couleur: document.getElementById('couleur').value,
                type: document.getElementById('type').value,
                cepage: document.getElementById('cepage').value,
                bio: document.getElementById('bio').value,
                degre: document.getElementById('degre').value,
                contenance: document.getElementById('contenance').value,
                aBoireJusque: document.getElementById('aBoireJusque').value,
                accords: accordsInput,
                notes: document.getElementById('notes').value
            };

            // Si les accords sont vides, rechercher automatiquement
            if (!accordsInput.trim()) {
                const button = event.submitter;
                button.disabled = true;
                button.textContent = 'Recherche des accords...';
                
                wine.accords = await searchFoodPairings(wine);
                
                button.disabled = false;
                button.textContent = 'Enregistrer';
            }

            if (isSpecial) {
                cellarData.specialWines[position] = wine;
            } else {
                cellarData.wines[position] = wine;
            }
            
            saveData();
            renderCellar();
            renderSpecialZone();
            updateStats();
            renderInventory();
            closeModal();
        }

        // Supprimer le vin
        function deleteWine() {
            if (confirm('Supprimer cette bouteille ?')) {
                const position = document.getElementById('cellPosition').value;
                const isSpecial = document.getElementById('cellPosition').dataset.isSpecial === 'true';
                
                if (isSpecial) {
                    delete cellarData.specialWines[position];
                } else {
                    delete cellarData.wines[position];
                }
                
                saveData();
                renderCellar();
                renderSpecialZone();
                updateStats();
                renderInventory();
                closeModal();
            }
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            const totalCells = cellarData.config.rows * cellarData.config.cols + (cellarData.config.specialZone || 0);
            const filledCells = Object.keys(cellarData.wines).length + Object.keys(cellarData.specialWines).length;
            const totalValue = [...Object.values(cellarData.wines), ...Object.values(cellarData.specialWines)]
                .reduce((sum, wine) => sum + (wine.prix || 0), 0);

            document.getElementById('totalBottles').textContent = filledCells;
            document.getElementById('emptySpaces').textContent = totalCells - filledCells;
            document.getElementById('totalValue').textContent = totalValue.toFixed(2) + '‚Ç¨';
        }

        // Afficher l'inventaire
        function renderInventory() {
            const list = document.getElementById('inventoryList');
            const wines = Object.entries(cellarData.wines);

            if (wines.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Aucune bouteille dans la cave</p>';
                return;
            }

            list.innerHTML = wines.map(([position, wine]) => `
                <div class="wine-info" style="cursor: pointer;" onclick="openModal('${position}')">
                    <h4>üç∑ ${wine.domaine} - ${wine.appellation} (${wine.annee})</h4>
                    <p><strong>Position:</strong> √âtag√®re ${parseInt(position.split('-')[0]) + 1}, Bouteille ${parseInt(position.split('-')[1]) + 1}</p>
                    <p><strong>Type:</strong> ${wine.type} - ${wine.couleur === 'red' ? 'Rouge' : wine.couleur === 'white' ? 'Blanc' : wine.couleur === 'rose' ? 'Ros√©' : wine.couleur === 'champagne' ? 'Champagne' : 'Autre'}</p>
                    ${wine.region ? `<p><strong>R√©gion:</strong> ${wine.region}, ${wine.pays}</p>` : ''}
                    ${wine.cepage ? `<p><strong>C√©page:</strong> ${wine.cepage}</p>` : ''}
                    ${wine.degre ? `<p><strong>Degr√©:</strong> ${wine.degre}%</p>` : ''}
                    ${wine.prix ? `<p><strong>Prix:</strong> ${wine.prix}‚Ç¨</p>` : ''}
                    ${wine.aBoireJusque ? `<p><strong>√Ä boire jusqu'en:</strong> ${wine.aBoireJusque}</p>` : ''}
                    ${wine.bio !== 'non' ? `<p><strong>üå± ${wine.bio === 'biodynamie' ? 'Biodynamie' : 'Bio'}</strong></p>` : ''}
                    ${wine.accords ? `<p><strong>Accords:</strong> ${wine.accords}</p>` : ''}
                    ${wine.notes ? `<p><strong>Notes:</strong> ${wine.notes}</p>` : ''}
                </div>
            `).join('');
        }

        // Filtrer l'inventaire
        function filterInventory() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const list = document.getElementById('inventoryList');
            const wines = Object.entries(cellarData.wines).filter(([_, wine]) => {
                return wine.domaine.toLowerCase().includes(searchTerm) ||
                       wine.appellation.toLowerCase().includes(searchTerm) ||
                       wine.annee.toString().includes(searchTerm) ||
                       (wine.region && wine.region.toLowerCase().includes(searchTerm));
            });

            if (wines.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Aucun r√©sultat</p>';
                return;
            }

            list.innerHTML = wines.map(([position, wine]) => `
                <div class="wine-info" style="cursor: pointer;" onclick="openModal('${position}')">
                    <h4>üç∑ ${wine.domaine} - ${wine.appellation} (${wine.annee})</h4>
                    <p><strong>Position:</strong> √âtag√®re ${parseInt(position.split('-')[0]) + 1}, Bouteille ${parseInt(position.split('-')[1]) + 1}</p>
                    <p><strong>Type:</strong> ${wine.type} - ${wine.couleur === 'red' ? 'Rouge' : wine.couleur === 'white' ? 'Blanc' : wine.couleur === 'rose' ? 'Ros√©' : wine.couleur === 'champagne' ? 'Champagne' : 'Autre'}</p>
                    ${wine