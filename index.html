<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempus Vinum - Gestionnaire de Cave</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 16px;
            transition: all 0.3s;
            color: #333;
            font-weight: 500;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #8B0000;
            font-weight: bold;
            color: #8B0000;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .config-section h3 {
            margin-bottom: 15px;
            color: #8B0000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8B0000;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: #8B0000;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover {
            background: #660000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
        }

        .cellar-grid {
            display: grid;
            gap: 12px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 20px;
            background: linear-gradient(180deg, #2c1810 0%, #1a0f08 100%);
            border-radius: 15px;
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.5);
        }

        .cell {
            aspect-ratio: 1;
            border: 3px solid #3d2817;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            position: relative;
            background: linear-gradient(145deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 90px;
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                inset 0 -2px 4px rgba(0,0,0,0.1),
                0 4px 8px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%, rgba(0,0,0,0.1) 100%);
            pointer-events: none;
        }

        .cell:hover {
            border-color: #8B0000;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.4),
                inset 0 -2px 4px rgba(0,0,0,0.2),
                0 10px 25px rgba(139,0,0,0.4);
            z-index: 10;
        }

        .cell.filled {
            background: linear-gradient(145deg, #8B0000 0%, #5a0000 100%);
            color: white;
            font-weight: bold;
            border-color: #6d0000;
            box-shadow: 
                inset 0 2px 8px rgba(255,255,255,0.2),
                inset 0 -2px 8px rgba(0,0,0,0.4),
                0 6px 12px rgba(0,0,0,0.4);
        }

        .cell.filled::after {
            content: 'üç∑';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            opacity: 0.3;
        }

        .cell.special {
            min-height: 130px;
            aspect-ratio: 0.65;
            border-width: 4px;
        }

        .cell.special.filled::after {
            content: 'üçæ';
            font-size: 20px;
        }

        .cell.red { 
            background: linear-gradient(145deg, #8B0000 0%, #5a0000 100%);
            border-color: #6d0000;
            color: white;
            box-shadow: 
                inset 0 2px 8px rgba(255,100,100,0.2),
                inset 0 -2px 8px rgba(0,0,0,0.5),
                0 6px 12px rgba(139,0,0,0.3);
        }
        
        .cell.white { 
            background: linear-gradient(145deg, #FFE5B4 0%, #F4D03F 100%);
            border-color: #d4af37;
            color: #333;
            box-shadow: 
                inset 0 2px 8px rgba(255,255,200,0.4),
                inset 0 -2px 8px rgba(0,0,0,0.2),
                0 6px 12px rgba(244,208,63,0.3);
        }
        
        .cell.rose { 
            background: linear-gradient(145deg, #FF85A1 0%, #FF5E7D 100%);
            border-color: #e04567;
            color: white;
            box-shadow: 
                inset 0 2px 8px rgba(255,180,200,0.3),
                inset 0 -2px 8px rgba(0,0,0,0.3),
                0 6px 12px rgba(255,94,125,0.3);
        }
        
        .cell.champagne { 
            background: linear-gradient(145deg, #F5DEB3 0%, #D4AF37 100%);
            border-color: #b8941f;
            color: #333;
            box-shadow: 
                inset 0 2px 8px rgba(255,255,220,0.5),
                inset 0 -2px 8px rgba(0,0,0,0.2),
                0 6px 12px rgba(212,175,55,0.4);
        }
        
        .cell.other { 
            background: linear-gradient(145deg, #9B59B6 0%, #7D3C98 100%);
            border-color: #6c2d7f;
            color: white;
            box-shadow: 
                inset 0 2px 8px rgba(180,140,200,0.3),
                inset 0 -2 8px rgba(0,0,0,0.4),
                0 6px 12px rgba(125,60,152,0.3);
        }

        .shelf-label {
            background: #2c1810;
            color: #d4af37;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            margin: 30px 0 10px 0;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid #3d2817;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .close {
            font-size: 30px;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .close:hover {
            color: #8B0000;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .wine-info {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .wine-info h4 {
            color: #8B0000;
            margin-bottom: 10px;
        }

        .wine-info p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .btn-print {
            background: #28a745;
            margin-left: 10px;
        }

        .btn-print:hover {
            background: #218838;
        }

        .btn-scan {
            background: #17a2b8;
            margin-left: 10px;
        }

        .btn-scan:hover {
            background: #138496;
        }

        .notification-card {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .notification-card.urgent {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .notification-card.info {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        #scannerModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
        }

        #scannerModal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #scannerVideo {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 10px;
        }

        .scanner-controls {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #printArea, #printArea * {
                visibility: visible;
            }
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }

        .btn-secondary {
            background: #666;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .legend-color {
            width: 35px;
            height: 35px;
            border-radius: 6px;
            border: 3px solid #3d2817;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üç∑ Tempus Vinum</h1>
            <p>G√©rez votre collection de vins avec style</p>
        </header>

        <div class="tabs">
            <button class="tab active" data-tab="config">Configuration</button>
            <button class="tab" data-tab="cellar">Ma Cave</button>
            <button class="tab" data-tab="inventory">Inventaire</button>
            <button class="tab" data-tab="notifications">Notifications</button>
        </div>

        <div id="config" class="tab-content active">
            <div class="config-section">
                <h3>üìê Configuration de la cave principale</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre d'√©tag√®res (rang√©es verticales)</label>
                        <input type="number" id="rows" value="5" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label>Nombre d'emplacements par √©tag√®re (horizontalement)</label>
                        <input type="number" id="cols" value="6" min="1" max="30">
                    </div>
                </div>
                <button id="btnInitCellar">Cr√©er/R√©initialiser la cave</button>
            </div>

            <div class="config-section">
                <h3>üçæ Zone sp√©ciale (grandes bouteilles)</h3>
                <div class="form-group">
                    <label>Nombre d'emplacements pour grandes bouteilles (Champagne, Magnum...)</label>
                    <input type="number" id="specialZone" value="7" min="0" max="20">
                </div>
                <button id="btnUpdateSpecialZone">Mettre √† jour la zone sp√©ciale</button>
            </div>

            <div class="config-section">
                <h3>üí° Configuration sugg√©r√©e pour votre cave</h3>
                <p>D'apr√®s votre description :</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>2 clayettes</strong> de 6 bouteilles = 12 bouteilles</li>
                    <li><strong>2 rang√©es au-dessus</strong> (3√ó6) = 18 bouteilles</li>
                    <li><strong>Total zone principale :</strong> 30 bouteilles (5 rang√©es √ó 6 emplacements)</li>
                    <li><strong>Zone sp√©ciale :</strong> 7 grandes bouteilles</li>
                    <li><strong>Capacit√© totale :</strong> 37 emplacements</li>
                </ul>
                <button id="btnApplySuggested">Appliquer cette configuration</button>
            </div>
        </div>

        <div id="cellar" class="tab-content">
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalBottles">0</h3>
                    <p>Bouteilles</p>
                </div>
                <div class="stat-card">
                    <h3 id="emptySpaces">0</h3>
                    <p>Emplacements vides</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalValue">0‚Ç¨</h3>
                    <p>Valeur totale</p>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #8B0000 0%, #4B0000 100%);"></div>
                    <span>Rouge</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);"></div>
                    <span>Blanc</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);"></div>
                    <span>Ros√©</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #F0E68C 0%, #DAA520 100%);"></div>
                    <span>Champagne</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);"></div>
                    <span>Autre</span>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #8B0000;">üç∑ Zone principale de la cave</h3>
            <div id="cellarGrid" class="cellar-grid"></div>

            <h3 style="margin: 30px 0 10px 0; color: #8B0000;">üçæ Zone grandes bouteilles (Champagne, Magnum...)</h3>
            <div id="specialZoneGrid" class="cellar-grid" style="grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); max-width: 900px;"></div>
        </div>

        <div id="inventory" class="tab-content">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Rechercher par nom, domaine, appellation, ann√©e...">
            </div>
            <div style="margin-bottom: 20px;">
                <button class="btn-print" id="btnPrintInventory">üìÑ Imprimer l'inventaire</button>
                <button class="btn-scan" id="btnScanBarcode">üì∑ Scanner un code-barres</button>
            </div>
            <div id="inventoryList"></div>
        </div>

        <div id="notifications" class="tab-content">
            <h2 style="color: #8B0000; margin-bottom: 20px;">üîî Notifications et Alertes</h2>
            <div id="notificationsList"></div>
        </div>
    </div>

    <div id="wineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ajouter une bouteille</h2>
                <span class="close" id="btnCloseModalX">&times;</span>
            </div>
            
            <form id="wineForm">
                <input type="hidden" id="cellPosition">
                
                <h3>Informations g√©n√©rales</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Appellation *</label>
                        <input type="text" id="appellation" required>
                    </div>
                    <div class="form-group">
                        <label>Domaine/Ch√¢teau *</label>
                        <input type="text" id="domaine" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>R√©coltant/Producteur</label>
                        <input type="text" id="recoltant">
                    </div>
                    <div class="form-group">
                        <label>Mill√©sime (ann√©e) *</label>
                        <input type="number" id="annee" min="1900" max="2030" required>
                    </div>
                </div>

                <h3>Caract√©ristiques</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Couleur *</label>
                        <select id="couleur" required>
                            <option value="red">Rouge</option>
                            <option value="white">Blanc</option>
                            <option value="rose">Ros√©</option>
                            <option value="champagne">Champagne/Effervescent</option>
                            <option value="other">Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="type">
                            <option value="vin">Vin tranquille</option>
                            <option value="champagne">Champagne</option>
                            <option value="cremant">Cr√©mant</option>
                            <option value="mousseux">Mousseux</option>
                            <option value="petillant">P√©tillant</option>
                            <option value="liquoreux">Liquoreux</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Pays</label>
                        <input type="text" id="pays" value="France">
                    </div>
                    <div class="form-group">
                        <label>R√©gion</label>
                        <input type="text" id="region">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>C√©page(s)</label>
                        <input type="text" id="cepage" placeholder="Ex: Cabernet Sauvignon, Merlot">
                    </div>
                    <div class="form-group">
                        <label>Degr√© d'alcool (%)</label>
                        <input type="number" id="degre" step="0.1" min="0" max="25">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Contenance (ml)</label>
                        <select id="contenance">
                            <option value="375">375 ml (Demi-bouteille)</option>
                            <option value="750" selected>750 ml (Bouteille standard)</option>
                            <option value="1500">1500 ml (Magnum)</option>
                            <option value="3000">3000 ml (J√©roboam)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bio ?</label>
                        <select id="bio">
                            <option value="non">Non</option>
                            <option value="oui">Oui</option>
                            <option value="biodynamie">Biodynamie</option>
                        </select>
                    </div>
                </div>

                <h3>Conservation et valeur</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Prix d'achat (‚Ç¨)</label>
                        <input type="number" id="prix" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>√Ä boire jusqu'en</label>
                        <input type="number" id="aBoireJusque" min="2024" max="2100">
                    </div>
                </div>

                <div class="form-group">
                    <label>Accords mets/vins</label>
                    <textarea id="accords" placeholder="Les accords seront recherch√©s automatiquement si laiss√© vide"></textarea>
                </div>

                <div class="form-group">
                    <label>Notes personnelles</label>
                    <textarea id="notes" placeholder="Vos commentaires, d√©gustation..."></textarea>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit">Enregistrer</button>
                    <button type="button" class="btn-secondary" id="btnCloseModal">Annuler</button>
                    <button type="button" class="btn-danger" id="deleteBtn" style="display:none;">Supprimer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scanner Modal -->
    <div id="scannerModal">
        <video id="scannerVideo" autoplay></video>
        <div class="scanner-controls">
            <button id="btnCloseScanner" class="btn-danger">Fermer</button>
        </div>
    </div>

    <!-- Zone d'impression cach√©e -->
    <div id="printArea" style="display: none;"></div>

    <script>
        // Variables globales
        let cellarData = {
            config: { rows: 5, cols: 6, specialZone: 7 },
            wines: {},
            specialWines: {}
        };

        // Fonctions principales
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName === 'inventory') {
                renderInventory();
            }
            if (tabName === 'notifications') {
                renderNotifications();
            }
        }

        function loadData() {
            const saved = localStorage.getItem('wineCellar');
            if (saved) {
                cellarData = JSON.parse(saved);
                document.getElementById('rows').value = cellarData.config.rows;
                document.getElementById('cols').value = cellarData.config.cols;
                document.getElementById('specialZone').value = cellarData.config.specialZone || 0;
            }
            renderCellar();
            renderSpecialZone();
            updateStats();
        }

        function saveData() {
            localStorage.setItem('wineCellar', JSON.stringify(cellarData));
        }

        function applySuggestedConfig() {
            document.getElementById('rows').value = 5;
            document.getElementById('cols').value = 6;
            document.getElementById('specialZone').value = 7;
            
            if (confirm('Appliquer la configuration sugg√©r√©e (5 rang√©es √ó 6 emplacements + 7 grandes bouteilles) ? Cela r√©initialisera votre cave.')) {
                cellarData.config = { rows: 5, cols: 6, specialZone: 7 };
                cellarData.wines = {};
                cellarData.specialWines = {};
                saveData();
                renderCellar();
                renderSpecialZone();
                updateStats();
                switchTab('cellar');
            }
        }

        function initCellar() {
            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);
            
            if (confirm('√ätes-vous s√ªr ? Cela r√©initialisera la zone principale de la cave.')) {
                cellarData.config.rows = rows;
                cellarData.config.cols = cols;
                cellarData.wines = {};
                saveData();
                renderCellar();
                updateStats();
                switchTab('cellar');
            }
        }

        function updateSpecialZone() {
            const specialZone = parseInt(document.getElementById('specialZone').value);
            
            if (confirm('√ätes-vous s√ªr ? Cela r√©initialisera la zone des grandes bouteilles.')) {
                cellarData.config.specialZone = specialZone;
                cellarData.specialWines = {};
                saveData();
                renderSpecialZone();
                updateStats();
                switchTab('cellar');
            }
        }

        function renderCellar() {
            const grid = document.getElementById('cellarGrid');
            const { rows, cols } = cellarData.config;
            
            grid.style.gridTemplateColumns = `repeat(${cols}, minmax(90px, 1fr))`;
            grid.innerHTML = '';

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const position = `${r}-${c}`;
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    const wine = cellarData.wines[position];
                    if (wine) {
                        cell.classList.add('filled', wine.couleur);
                        cell.innerHTML = `<div style="text-align: center; padding: 8px; position: relative; z-index: 1;">
                            <div style="font-weight: bold; font-size: 0.85em; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">${wine.domaine}</div>
                            <div style="font-size: 0.75em; opacity: 0.9; margin-top: 2px;">${wine.annee}</div>
                        </div>`;
                    } else {
                        cell.innerHTML = `<div style="font-size: 2.5em; opacity: 0.2; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">+</div>`;
                    }
                    
                    cell.addEventListener('click', () => openModal(position, false));
                    grid.appendChild(cell);
                }
            }
        }

        function renderSpecialZone() {
            const grid = document.getElementById('specialZoneGrid');
            const specialZone = cellarData.config.specialZone || 0;
            
            grid.innerHTML = '';

            for (let i = 0; i < specialZone; i++) {
                const position = `special-${i}`;
                const cell = document.createElement('div');
                cell.className = 'cell special';
                
                const wine = cellarData.specialWines[position];
                if (wine) {
                    cell.classList.add('filled', wine.couleur);
                    cell.innerHTML = `<div style="text-align: center; padding: 10px; position: relative; z-index: 1;">
                        <div style="font-weight: bold; font-size: 0.9em; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">${wine.domaine}</div>
                        <div style="font-size: 0.8em; opacity: 0.9; margin-top: 3px;">${wine.annee}</div>
                        <div style="font-size: 0.7em; opacity: 0.85; margin-top: 5px; background: rgba(0,0,0,0.2); padding: 3px 6px; border-radius: 4px; display: inline-block;">${wine.contenance}ml</div>
                    </div>`;
                } else {
                    cell.innerHTML = `<div style="font-size: 3em; opacity: 0.2; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">+</div>`;
                }
                
                cell.addEventListener('click', () => openModal(position, true));
                grid.appendChild(cell);
            }
        }

        function openModal(position, isSpecial) {
            const modal = document.getElementById('wineModal');
            const wine = isSpecial ? cellarData.specialWines[position] : cellarData.wines[position];
            
            document.getElementById('cellPosition').value = position;
            document.getElementById('cellPosition').dataset.isSpecial = isSpecial;
            
            if (wine) {
                const posDisplay = isSpecial ? 
                    `Grande bouteille n¬∞${parseInt(position.split('-')[1]) + 1}` :
                    `√âtag√®re ${parseInt(position.split('-')[0]) + 1}, Emplacement ${parseInt(position.split('-')[1]) + 1}`;
                document.getElementById('modalTitle').textContent = `Modifier - ${posDisplay}`;
                document.getElementById('deleteBtn').style.display = 'inline-block';
                
                Object.keys(wine).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) input.value = wine[key] || '';
                });
            } else {
                const posDisplay = isSpecial ? 
                    `Grande bouteille n¬∞${parseInt(position.split('-')[1]) + 1}` :
                    `√âtag√®re ${parseInt(position.split('-')[0]) + 1}, Emplacement ${parseInt(position.split('-')[1]) + 1}`;
                document.getElementById('modalTitle').textContent = `Ajouter - ${posDisplay}`;
                document.getElementById('deleteBtn').style.display = 'none';
                document.getElementById('wineForm').reset();
            }
            
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('wineModal').classList.remove('active');
        }

        async function searchFoodPairings(wine) {
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `Sugg√®re 3-5 accords mets/vins pour un ${wine.couleur === 'red' ? 'vin rouge' : wine.couleur === 'white' ? 'vin blanc' : wine.couleur === 'rose' ? 'vin ros√©' : 'vin'} ${wine.appellation} de ${wine.annee}. R√©ponds uniquement avec une liste courte et concise, sans introduction.`
                        }]
                    })
                });

                const data = await response.json();
                if (data.content && data.content[0] && data.content[0].text) {
                    return data.content[0].text.trim();
                }
            } catch (error) {
                console.log('Recherche d\'accords non disponible');
            }
            return '';
        }

        async function saveWine(event) {
            event.preventDefault();
            
            const position = document.getElementById('cellPosition').value;
            const isSpecial = document.getElementById('cellPosition').dataset.isSpecial === 'true';
            const accordsInput = document.getElementById('accords').value;
            
            const wine = {
                appellation: document.getElementById('appellation').value,
                domaine: document.getElementById('domaine').value,
                recoltant: document.getElementById('recoltant').value,
                annee: document.getElementById('annee').value,
                prix: parseFloat(document.getElementById('prix').value) || 0,
                pays: document.getElementById('pays').value,
                region: document.getElementById('region').value,
                couleur: document.getElementById('couleur').value,
                type: document.getElementById('type').value,
                cepage: document.getElementById('cepage').value,
                bio: document.getElementById('bio').value,
                degre: document.getElementById('degre').value,
                contenance: document.getElementById('contenance').value,
                aBoireJusque: document.getElementById('aBoireJusque').value,
                accords: accordsInput,
                notes: document.getElementById('notes').value
            };

            if (!accordsInput.trim()) {
                const button = event.submitter;
                button.disabled = true;
                button.textContent = 'Recherche des accords...';
                
                wine.accords = await searchFoodPairings(wine);
                
                button.disabled = false;
                button.textContent = 'Enregistrer';
            }

            if (isSpecial) {
                cellarData.specialWines[position] = wine;
            } else {
                cellarData.wines[position] = wine;
            }
            
            saveData();
            renderCellar();
            renderSpecialZone();
            updateStats();
            renderInventory();
            closeModal();
        }

        function deleteWine() {
            if (confirm('Supprimer cette bouteille ?')) {
                const position = document.getElementById('cellPosition').value;
                const isSpecial = document.getElementById('cellPosition').dataset.isSpecial === 'true';
                
                if (isSpecial) {
                    delete cellarData.specialWines[position];
                } else {
                    delete cellarData.wines[position];
                }
                
                saveData();
                renderCellar();
                renderSpecialZone();
                updateStats();
                renderInventory();
                closeModal();
            }
        }

        function updateStats() {
            const totalCells = cellarData.config.rows * cellarData.config.cols + (cellarData.config.specialZone || 0);
            const filledCells = Object.keys(cellarData.wines).length + Object.keys(cellarData.specialWines).length;
            const totalValue = [...Object.values(cellarData.wines), ...Object.values(cellarData.specialWines)]
                .reduce((sum, wine) => sum + (wine.prix || 0), 0);

            document.getElementById('totalBottles').textContent = filledCells;
            document.getElementById('emptySpaces').textContent = totalCells - filledCells;
            document.getElementById('totalValue').textContent = totalValue.toFixed(2) + '‚Ç¨';
        }

        function renderInventory() {
            const list = document.getElementById('inventoryList');
            const allWines = [
                ...Object.entries(cellarData.wines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: false })),
                ...Object.entries(cellarData.specialWines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: true }))
            ];

            if (allWines.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Aucune bouteille dans la cave</p>';
                return;
            }

            list.innerHTML = allWines.map(wine => {
                const posDisplay = wine.isSpecial ?
                    `Grande bouteille n¬∞${parseInt(wine.position.split('-')[1]) + 1}` :
                    `√âtag√®re ${parseInt(wine.position.split('-')[0]) + 1}, Emplacement ${parseInt(wine.position.split('-')[1]) + 1}`;
                
                return `
                <div class="wine-info" style="cursor: pointer;" data-position="${wine.position}" data-special="${wine.isSpecial}">
                    <h4>üç∑ ${wine.domaine} - ${wine.appellation} (${wine.annee})</h4>
                    <p><strong>Position:</strong> ${posDisplay}</p>
                    <p><strong>Type:</strong> ${wine.type} - ${wine.couleur === 'red' ? 'Rouge' : wine.couleur === 'white' ? 'Blanc' : wine.couleur === 'rose' ? 'Ros√©' : wine.couleur === 'champagne' ? 'Champagne' : 'Autre'}</p>
                    ${wine.region ? `<p><strong>R√©gion:</strong> ${wine.region}, ${wine.pays}</p>` : ''}
                    ${wine.cepage ? `<p><strong>C√©page:</strong> ${wine.cepage}</p>` : ''}
                    ${wine.degre ? `<p><strong>Degr√©:</strong> ${wine.degre}%</p>` : ''}
                    <p><strong>Contenance:</strong> ${wine.contenance}ml</p>
                    ${wine.prix ? `<p><strong>Prix:</strong> ${wine.prix}‚Ç¨</p>` : ''}
                    ${wine.aBoireJusque ? `<p><strong>√Ä boire jusqu'en:</strong> ${wine.aBoireJusque}</p>` : ''}
                    ${wine.bio !== 'non' ? `<p><strong>üå± ${wine.bio === 'biodynamie' ? 'Biodynamie' : 'Bio'}</strong></p>` : ''}
                    ${wine.accords ? `<p><strong>Accords:</strong> ${wine.accords}</p>` : ''}
                    ${wine.notes ? `<p><strong>Notes:</strong> ${wine.notes}</p>` : ''}
                </div>
            `;
            }).join('');
            
            document.querySelectorAll('.wine-info').forEach(el => {
                el.addEventListener('click', function() {
                    openModal(this.dataset.position, this.dataset.special === 'true');
                });
            });
        }

        function filterInventory() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const list = document.getElementById('inventoryList');
            const allWines = [
                ...Object.entries(cellarData.wines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: false })),
                ...Object.entries(cellarData.specialWines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: true }))
            ].filter(wine => {
                return wine.domaine.toLowerCase().includes(searchTerm) ||
                       wine.appellation.toLowerCase().includes(searchTerm) ||
                       wine.annee.toString().includes(searchTerm) ||
                       (wine.region && wine.region.toLowerCase().includes(searchTerm));
            });

            if (allWines.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Aucun r√©sultat</p>';
                return;
            }

            list.innerHTML = allWines.map(wine => {
                const posDisplay = wine.isSpecial ?
                    `Grande bouteille n¬∞${parseInt(wine.position.split('-')[1]) + 1}` :
                    `√âtag√®re ${parseInt(wine.position.split('-')[0]) + 1}, Emplacement ${parseInt(wine.position.split('-')[1]) + 1}`;
                
                return `
                <div class="wine-info" style="cursor: pointer;" data-position="${wine.position}" data-special="${wine.isSpecial}">
                    <h4>üç∑ ${wine.domaine} - ${wine.appellation} (${wine.annee})</h4>
                    <p><strong>Position:</strong> ${posDisplay}</p>
                    <p><strong>Type:</strong> ${wine.type} - ${wine.couleur === 'red' ? 'Rouge' : wine.couleur === 'white' ? 'Blanc' : wine.couleur === 'rose' ? 'Ros√©' : wine.couleur === 'champagne' ? 'Champagne' : 'Autre'}</p>
                    ${wine.region ? `<p><strong>R√©gion:</strong> ${wine.region}, ${wine.pays}</p>` : ''}
                    ${wine.cepage ? `<p><strong>C√©page:</strong> ${wine.cepage}</p>` : ''}
                    ${wine.degre ? `<p><strong>Degr√©:</strong> ${wine.degre}%</p>` : ''}
                    <p><strong>Contenance:</strong> ${wine.contenance}ml</p>
                    ${wine.prix ? `<p><strong>Prix:</strong> ${wine.prix}‚Ç¨</p>` : ''}
                    ${wine.aBoireJusque ? `<p><strong>√Ä boire jusqu'en:</strong> ${wine.aBoireJusque}</p>` : ''}
                    ${wine.bio !== 'non' ? `<p><strong>üå± ${wine.bio === 'biodynamie' ? 'Biodynamie' : 'Bio'}</strong></p>` : ''}
                    ${wine.accords ? `<p><strong>Accords:</strong> ${wine.accords}</p>` : ''}
                    ${wine.notes ? `<p><strong>Notes:</strong> ${wine.notes}</p>` : ''}
                </div>
            `;
            }).join('');
            
            document.querySelectorAll('.wine-info').forEach(el => {
                el.addEventListener('click', function() {
                    openModal(this.dataset.position, this.dataset.special === 'true');
                });
            });
        }

        // Fonction pour imprimer l'inventaire
        function printInventory() {
            const allWines = [
                ...Object.entries(cellarData.wines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: false })),
                ...Object.entries(cellarData.specialWines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: true }))
            ];

            if (allWines.length === 0) {
                alert('Aucune bouteille √† imprimer !');
                return;
            }

            const printArea = document.getElementById('printArea');
            const currentDate = new Date().toLocaleDateString('fr-FR');
            
            let html = `
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="color: #8B0000; font-size: 32px;">üç∑ Tempus Vinum</h1>
                        <h2 style="color: #333;">Inventaire de ma cave</h2>
                        <p style="color: #666;">√âdit√© le ${currentDate}</p>
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px;">
                        <strong>Statistiques :</strong><br>
                        Nombre total de bouteilles : ${allWines.length}<br>
                        Valeur totale : ${allWines.reduce((sum, wine) => sum + (wine.prix || 0), 0).toFixed(2)}‚Ç¨
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #8B0000; color: white;">
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Position</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Domaine</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Appellation</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Ann√©e</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Couleur</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">R√©gion</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Prix</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">√Ä boire jusqu'en</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            allWines.forEach(wine => {
                const posDisplay = wine.isSpecial ?
                    `Grande bouteille n¬∞${parseInt(wine.position.split('-')[1]) + 1}` :
                    `√ât. ${parseInt(wine.position.split('-')[0]) + 1}, Emp. ${parseInt(wine.position.split('-')[1]) + 1}`;
                
                const couleurText = wine.couleur === 'red' ? 'Rouge' : 
                                   wine.couleur === 'white' ? 'Blanc' : 
                                   wine.couleur === 'rose' ? 'Ros√©' : 
                                   wine.couleur === 'champagne' ? 'Champagne' : 'Autre';

                html += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="border: 1px solid #ddd; padding: 8px;">${posDisplay}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;"><strong>${wine.domaine}</strong></td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${wine.appellation}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${wine.annee}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${couleurText}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${wine.region || '-'}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">${wine.prix ? wine.prix + '‚Ç¨' : '-'}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${wine.aBoireJusque || '-'}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            printArea.innerHTML = html;
            printArea.style.display = 'block';
            window.print();
            printArea.style.display = 'none';
        }

        // Fonction pour scanner un code-barres
        let scannerStream = null;
        
        async function startBarcodeScanner() {
            const modal = document.getElementById('scannerModal');
            const video = document.getElementById('scannerVideo');
            
            try {
                scannerStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                video.srcObject = scannerStream;
                modal.classList.add('active');
                
                // Simulation de d√©tection de code-barres
                // Pour une vraie impl√©mentation, utilisez une biblioth√®que comme QuaggaJS
                alert('üì∑ Scanner activ√© !\n\nNote : Cette fonctionnalit√© n√©cessite une biblioth√®que externe comme QuaggaJS pour d√©tecter r√©ellement les codes-barres.\n\nPour l\'instant, vous pouvez saisir manuellement le code-barres.');
                
                const barcode = prompt('Entrez le code-barres (simulation) :');
                if (barcode) {
                    await searchWineByBarcode(barcode);
                }
                
                stopBarcodeScanner();
            } catch (error) {
                console.error('Erreur d\'acc√®s √† la cam√©ra:', error);
                alert('‚ùå Impossible d\'acc√©der √† la cam√©ra.\n\nVeuillez v√©rifier les permissions de votre navigateur.');
            }
        }

        function stopBarcodeScanner() {
            if (scannerStream) {
                scannerStream.getTracks().forEach(track => track.stop());
                scannerStream = null;
            }
            document.getElementById('scannerModal').classList.remove('active');
        }

        async function searchWineByBarcode(barcode) {
            // Recherche via API Claude pour obtenir des infos sur le vin
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `Trouve les informations sur le vin avec le code-barres ${barcode}. R√©ponds uniquement en JSON avec les champs: domaine, appellation, annee, region, pays, couleur, cepage, type. Si tu ne trouves pas, r√©ponds "non trouv√©".`
                        }]
                    })
                });

                const data = await response.json();
                if (data.content && data.content[0] && data.content[0].text) {
                    const result = data.content[0].text.trim();
                    if (result !== 'non trouv√©') {
                        alert('‚úÖ Vin trouv√© !\n\n' + result);
                        // Vous pouvez pr√©-remplir le formulaire ici
                    } else {
                        alert('‚ùå Vin non trouv√© dans la base de donn√©es.');
                    }
                }
            } catch (error) {
                console.error('Erreur de recherche:', error);
                alert('‚ùå Erreur lors de la recherche du vin.');
            }
        }

        // Fonction pour afficher les notifications
        function renderNotifications() {
            const list = document.getElementById('notificationsList');
            const allWines = [
                ...Object.entries(cellarData.wines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: false })),
                ...Object.entries(cellarData.specialWines).map(([pos, wine]) => ({ ...wine, position: pos, isSpecial: true }))
            ];

            const currentYear = new Date().getFullYear();
            const notifications = [];

            // Vins √† boire cette ann√©e (urgent)
            const toDrinkThisYear = allWines.filter(wine => 
                wine.aBoireJusque && parseInt(wine.aBoireJusque) === currentYear
            );

            // Vins √† boire l'ann√©e prochaine (attention)
            const toDrinkNextYear = allWines.filter(wine => 
                wine.aBoireJusque && parseInt(wine.aBoireJusque) === currentYear + 1
            );

            // Vins d√©pass√©s
            const overdue = allWines.filter(wine => 
                wine.aBoireJusque && parseInt(wine.aBoireJusque) < currentYear
            );

            let html = '';

            if (overdue.length > 0) {
                html += `
                    <div class="notification-card urgent">
                        <h3 style="color: #dc3545; margin-bottom: 10px;">‚ö†Ô∏è Vins d√©pass√©s (${overdue.length})</h3>
                        <p style="margin-bottom: 10px;">Ces vins ont d√©pass√© leur date de consommation optimale :</p>
                        <ul style="margin-left: 20px;">
                `;
                overdue.forEach(wine => {
                    const posDisplay = wine.isSpecial ?
                        `Grande bouteille n¬∞${parseInt(wine.position.split('-')[1]) + 1}` :
                        `√âtag√®re ${parseInt(wine.position.split('-')[0]) + 1}, Emplacement ${parseInt(wine.position.split('-')[1]) + 1}`;
                    html += `<li><strong>${wine.domaine} ${wine.annee}</strong> - ${posDisplay} (√† boire jusqu'en ${wine.aBoireJusque})</li>`;
                });
                html += `</ul></div>`;
            }

            if (toDrinkThisYear.length > 0) {
                html += `
                    <div class="notification-card urgent">
                        <h3 style="color: #dc3545; margin-bottom: 10px;">üö® √Ä boire cette ann√©e ! (${toDrinkThisYear.length})</h3>
                        <p style="margin-bottom: 10px;">Ces vins doivent √™tre bus avant la fin ${currentYear} :</p>
                        <ul style="margin-left: 20px;">
                `;
                toDrinkThisYear.forEach(wine => {
                    const posDisplay = wine.isSpecial ?
                        `Grande bouteille n¬∞${parseInt(wine.position.split('-')[1]) + 1}` :
                        `√âtag√®re ${parseInt(wine.position.split('-')[0]) + 1}, Emplacement ${parseInt(wine.position.split('-')[1]) + 1}`;
                    html += `<li><strong>${wine.domaine} ${wine.annee}</strong> - ${posDisplay}</li>`;
                });
                html += `</ul></div>`;
            }

            if (toDrinkNextYear.length > 0) {
                html += `
                    <div class="notification-card">
                        <h3 style="color: #ffc107; margin-bottom: 10px;">‚è∞ √Ä boire l'ann√©e prochaine (${toDrinkNextYear.length})</h3>
                        <p style="margin-bottom: 10px;">Ces vins seront √† leur apog√©e en ${currentYear + 1} :</p>
                        <ul style="margin-left: 20px;">
                `;
                toDrinkNextYear.forEach(wine => {
                    const posDisplay = wine.isSpecial ?
                        `Grande bouteille n¬∞${parseInt(wine.position.split('-')[1]) + 1}` :
                        `√âtag√®re ${parseInt(wine.position.split('-')[0]) + 1}, Emplacement ${parseInt(wine.position.split('-')[1]) + 1}`;
                    html += `<li><strong>${wine.domaine} ${wine.annee}</strong> - ${posDisplay}</li>`;
                });
                html += `</ul></div>`;
            }

            // Statistiques g√©n√©rales
            const totalValue = allWines.reduce((sum, wine) => sum + (wine.prix || 0), 0);
            const avgPrice = allWines.length > 0 ? (totalValue / allWines.length).toFixed(2) : 0;
            
            html += `
                <div class="notification-card info">
                    <h3 style="color: #17a2b8; margin-bottom: 10px;">üìä Statistiques de la cave</h3>
                    <p><strong>Nombre total de bouteilles :</strong> ${allWines.length}</p>
                    <p><strong>Valeur totale :</strong> ${totalValue.toFixed(2)}‚Ç¨</p>
                    <p><strong>Prix moyen par bouteille :</strong> ${avgPrice}‚Ç¨</p>
                    <p><strong>Emplacements vides :</strong> ${cellarData.config.rows * cellarData.config.cols + (cellarData.config.specialZone || 0) - allWines.length}</p>
                </div>
            `;

            if (overdue.length === 0 && toDrinkThisYear.length === 0 && toDrinkNextYear.length === 0) {
                html += `
                    <div class="notification-card info">
                        <h3 style="color: #17a2b8;">‚úÖ Aucune alerte</h3>
                        <p>Tous vos vins sont bien conserv√©s ! Continuez comme √ßa. üç∑</p>
                    </div>
                `;
            }

            list.innerHTML = html;
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
            
            document.getElementById('btnInitCellar').addEventListener('click', initCellar);
            document.getElementById('btnUpdateSpecialZone').addEventListener('click', updateSpecialZone);
            document.getElementById('btnApplySuggested').addEventListener('click', applySuggestedConfig);
            
            document.getElementById('btnCloseModal').addEventListener('click', closeModal);
            document.getElementById('btnCloseModalX').addEventListener('click', closeModal);
            document.getElementById('deleteBtn').addEventListener('click', deleteWine);
            document.getElementById('wineForm').addEventListener('submit', saveWine);
            
            document.getElementById('searchInput').addEventListener('keyup', filterInventory);
            
            document.getElementById('btnPrintInventory').addEventListener('click', printInventory);
            document.getElementById('btnScanBarcode').addEventListener('click', startBarcodeScanner);
            document.getElementById('btnCloseScanner').addEventListener('click', stopBarcodeScanner);
        });
    </script>
</body>
</html>